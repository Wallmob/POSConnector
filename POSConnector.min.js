var POSConnector=function(){"use strict";var a={},i="POSConnector",r=0,c={},o=[],t="GetLoginInformation",s="GetLoginInformationCallback",u="PayBasket",l="PayBasketCallback",d="AddBasket",f="BarcodeScanned",p="OpenURL",b="OpenURLCallback",m="PrintDocumentAtURL",y="PrintDocumentWithData",v="PrintDocumentCallback",k="SendPOSConnectorObjectPathToPOS",P="SendPOSConnectorObjectPathToPOSCallback",g="basket",w="url",h="data",C="objectPath",I="validate",O="closeWebview";function S(e,n){var t={};return t.type=e,t.listenerCallback=n,t}function E(e,n,t){var o;return"function"==typeof n?(c[o=r]=n,r+=1,new E(e,o,t)):((o={}).name=e,o.callbackId=n,o.body=t,o)}function j(e,n){"function"==typeof e&&e.apply(void 0,n)}function D(e){var n,t;return a.isConnected()?(n=(e=e).split("."),t=window,"string"==typeof(n=n.some(function(e){if(!t.hasOwnProperty(e)||"object"!=typeof t[e])return!0;t=t[e]})?"Invalid component(s) in object path: "+e:"function"!=typeof t.receiveMessage?"Invalid POSConnector object at the end of object path: "+e:void 0)?n:void 0):"No connection is established from the native POS application"}function n(e){var n;if("number"==typeof e)return n=c[e],delete c[e],n}function B(e){window.webkit.messageHandlers.POS.postMessage(e)}function L(e){j(n(e.callbackId),[e.body.result,e.body.error])}function x(e){j(n(e.callbackId),[e.body.error])}a.receiveMessage=function(e){switch(e.name){case f:n=e.body,o.forEach(function(e){e.type===a.EventType.BarcodeScanned&&e.listenerCallback(n)});break;case s:case l:L(e);break;case b:x(e);break;case v:L(e);break;case P:x(e)}var n},a.LineItem=function(e,n,t,o=null,a=null,r=null,i=null,c=null,s=null){return{name:e,quantity:n,unitPrice:t,vatPercentage:o,salesTaxPercentage:a,productId:r,imei:i,discounts:c,isExternalProduct:s}};a.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Vipps:"Vipps",Dintero:"Dintero",Invoice:"Invoice"},a.Transaction=function(e,n){var t={};return t.transactionType=e,t.amount=n,t},a.Discount=function(e,n=null,t=null){if(null==n&&null==t||null!=n&&null!=t)throw new Error("Either amount or percentage must be set, but not both");return{description:e,amount:n,percentage:t}},a.Basket=function(e,n,t=null,o=null,a=null){return{id:e,lineItems:n,transactions:t,discounts:o,customerId:a}},a.LoginInformation=function(e,n,t,o,a,r){var i={};return i.shopId=e,i.shopName=n,i.registerId=t,i.registerName=o,i.userId=a,i.userName=r,i};return a.EventType={BarcodeScanned:"BarcodeScanned"},a.addEventListener=function(e,n){o.push(new S(e,n))},a.removeEventListener=function(t){o.forEach(function(e,n){e.listenerCallback===t&&o.splice(n,1)})},a.isConnected=function(){return"object"==typeof window.webkit&&"object"==typeof window.webkit.messageHandlers&&"object"==typeof window.webkit.messageHandlers.POS},a.payBasket=function(e,n,t=!1){a.sendBasket(u,e,n,t,!0)},a.addBasket=function(e,n,t=!1,o=!0){a.sendBasket(d,e,n,t,o)},a.sendBasket=function(e,n,t,o,a){var r=D(i);"string"==typeof r?j(t,[!1,r]):B(new E(e,t,{[g]:n,[I]:o,[O]:a}))},a.getLoginInformation=function(e){var n=D(i);"string"==typeof n?j(e,[null,n]):B(new E(t,e))},a.openURL=function(e,n){var t=D(i);"string"==typeof t?j(n,[t]):((t={})[w]=e,B(new E(p,n,t)))},a.printDocumentAtURL=function(e,n){var t=D(i);"string"==typeof t?j(n,[!1,t]):((t={})[w]=e,B(new E(m,n,t)))},a.printDocumentWithData=function(e,t){var n,o,a=D(i);"string"==typeof a?j(t,[a]):(n=function(e){var n={};n[h]=e,B(new E(y,t,n))},"string"!=(a=typeof e)&&"object"!=a&&j(t,[!1,"Data argument of invalid type: "+a]),"string"==a?n(e):((o=new FileReader).onload=function(){var e=o.result,e=e.substr(e.indexOf(",")+1);n(e)},o.readAsDataURL(e)))},a.sendPOSConnectorObjectPathToPOS=function(n,t){var e=D(n);"string"==typeof e?j(t,[e]):((e={})[C]=n,B(new E(k,function(e){"string"==typeof e&&j(t,[e]),i=n,j(t)},e)))},a}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);