var POSConnector=function(){"use strict";function e(e,t){var n={};return n.type=e,n.listenerCallback=t,n}function t(e,n,a){if("function"==typeof n){var o=f;return b[o]=n,f+=1,new t(e,o,a)}var r={};return r.name=e,r.callbackId=n,r.body=a,r}function n(e,t){"function"==typeof e&&e.apply(void 0,t)}function a(e){var t=e.split("."),n=window,a=t.some(function(e){return!n.hasOwnProperty(e)||"object"!=typeof n[e]||void(n=n[e])});return a?"Invalid component(s) in object path: "+e:"function"!=typeof n.receiveMessage?"Invalid POSConnector object at the end of object path: "+e:void 0}function o(e){if(!d.isConnected())return"No connection is established from the native POS application";var t=a(e);return"string"==typeof t?t:void 0}function r(e){if("number"==typeof e){var t=b[e];return delete b[e],t}}function i(e){window.webkit.messageHandlers.POS.postMessage(e)}function c(e){var t=r(e.callbackId),a=e.body.result,o=e.body.error;n(t,[a,o])}function s(e){var t=r(e.callbackId),a=e.body.error;n(t,[a])}function u(e){var t=e.body;v.forEach(function(e){e.type===d.EventType.BarcodeScanned&&e.listenerCallback(t)})}var d={},l="POSConnector",f=0,b={},v=[],p={GetLoginInformation:"GetLoginInformation",GetLoginInformationCallback:"GetLoginInformationCallback",AddBasket:"AddBasket",AddBasketCallback:"AddBasketCallback",PayBasket:"PayBasket",PayBasketCallback:"PayBasketCallback",BarcodeScanned:"BarcodeScanned",OpenURL:"OpenURL",OpenURLCallback:"OpenURLCallback",PrintDocumentAtURL:"PrintDocumentAtURL",PrintDocumentWithData:"PrintDocumentWithData",PrintDocumentCallback:"PrintDocumentCallback",SendPOSConnectorObjectPathToPOS:"SendPOSConnectorObjectPathToPOS",SendPOSConnectorObjectPathToPOSCallback:"SendPOSConnectorObjectPathToPOSCallback"},P={Result:"result",Error:"error",Basket:"basket",URL:"url",Data:"data",ObjectPath:"objectPath"};d.receiveMessage=function(e){switch(e.name){case p.BarcodeScanned:u(e);break;case p.GetLoginInformationCallback:c(e);break;case p.AddBasketCallback:c(e);break;case p.PayBasketCallback:c(e);break;case p.OpenURLCallback:s(e);break;case p.PrintDocumentCallback:c(e);break;case p.SendPOSConnectorObjectPathToPOSCallback:s(e)}},d.LineItem=function(e,t,n,a,o,r,i,c,s){var u={};return u.name=e,u.quantity=t,u.unitPrice=n,u.vatPercentage=a,u.salesTaxPercentage=o,u.productId=r,u.imei=i,u.discounts=c,u.isExternalProduct=Boolean(s),u};var k={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Point:"Point"};d.TransactionType=k,d.Transaction=function(e,t){var n={};return n.transactionType=e,n.amount=t,n},d.Discount=function(e,t,n){var a={};return a.description=e,a.amount=t,a.percentage=n,a},d.Basket=function(e,t,n,a){var o={};return o.id=e,o.lineItems=t,o.transactions=n,o.discounts=a,o},d.LoginInformation=function(e,t,n,a,o,r){var i={};return i.shopId=e,i.shopName=t,i.registerId=n,i.registerName=a,i.userId=o,i.userName=r,i};var m={BarcodeScanned:"BarcodeScanned"};return d.EventType=m,d.addEventListener=function(t,n){v.push(new e(t,n))},d.removeEventListener=function(e){v.forEach(function(t,n){t.listenerCallback===e&&v.splice(n,1)})},d.isConnected=function(){return"object"==typeof window.webkit&&"object"==typeof window.webkit.messageHandlers&&"object"==typeof window.webkit.messageHandlers.POS},d.addBasket=function(e,a){var r=o(l);if("string"==typeof r)return void n(a,[!1,r]);var c={};c[P.Basket]=e;var s=new t(p.AddBasket,a,c);i(s)},d.payBasket=function(e,a){var r=o(l);if("string"==typeof r)return void n(a,[!1,r]);var c={};c[P.Basket]=e;var s=new t(p.PayBasket,a,c);i(s)},d.getLoginInformation=function(e){var a=o(l);if("string"==typeof a)return void n(e,[null,a]);var r=new t(p.GetLoginInformation,e);i(r)},d.openURL=function(e,a){var r=o(l);if("string"==typeof r)return void n(a,[r]);var c={};c[P.URL]=e;var s=new t(p.OpenURL,a,c);i(s)},d.printDocumentAtURL=function(e,a){var r=o(l);if("string"==typeof r)return void n(a,[!1,r]);var c={};c[P.URL]=e;var s=new t(p.PrintDocumentAtURL,a,c);i(s)},d.printDocumentWithData=function(e,a){var r=o(l);if("string"==typeof r)return void n(a,[r]);var c=function(e){var n={};n[P.Data]=e;var o=new t(p.PrintDocumentWithData,a,n);i(o)},s=typeof e;if("string"!==s&&"object"!==s&&n(a,[!1,"Data argument of invalid type: "+s]),"string"===s)return void c(e);if("object"!=typeof FileReader||"object"!=typeof Blob)return void n(a,[!1,"The required FileReader and/or Blob functionality isn't available in this Javascript environment"]);var u=new FileReader;u.onload=function(){var e=u.result,t=e.substr(e.indexOf(",")+1);c(t)},u.readAsDataURL(e)},d.sendPOSConnectorObjectPathToPOS=function(e,a){var r=o(e);if("string"==typeof r)return void n(a,[r]);var c=function(t){"string"==typeof t&&n(a,[t]),l=e,n(a)},s={};s[P.ObjectPath]=e;var u=new t(p.SendPOSConnectorObjectPathToPOS,c,s);i(u)},d}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);