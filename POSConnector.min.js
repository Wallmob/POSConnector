var POSConnector=function(){"use strict";var s={},i="POSConnector",r=0,o={},a=[],t="GetLoginInformation",c="GetLoginInformationCallback",l="PayBasket",u="PayBasketCallback",d="AddBasket",f="BarcodeScanned",p="OpenURL",b="OpenURLCallback",y="PrintDocumentAtURL",m="PrintDocumentWithData",v="PrintDocumentCallback",g="SendPOSConnectorObjectPathToPOS",h="SendPOSConnectorObjectPathToPOSCallback",k="basket",P="url",w="data",C="objectPath",I="validate",O="closeWebview";function S(e,n){var t={};return t.type=e,t.listenerCallback=n,t}function V(e,n,t){var a;return"function"==typeof n?(o[a=r]=n,r+=1,new V(e,a,t)):((a={}).name=e,a.callbackId=n,a.body=t,a)}function E(e,n){"function"==typeof e&&e.apply(void 0,n)}function j(e){var n,t;return s.isConnected()?(n=(e=e).split("."),t=window,"string"==typeof(n=n.some(function(e){if(!t.hasOwnProperty(e)||"object"!=typeof t[e])return!0;t=t[e]})?"Invalid component(s) in object path: "+e:"function"!=typeof t.receiveMessage?"Invalid POSConnector object at the end of object path: "+e:void 0)?n:void 0):"No connection is established from the native POS application"}function n(e){var n;if("number"==typeof e)return n=o[e],delete o[e],n}function A(e){window.webkit.messageHandlers.POS.postMessage(e)}function B(e){E(n(e.callbackId),[e.body.result,e.body.error])}function D(e){E(n(e.callbackId),[e.body.error])}s.receiveMessage=function(e){switch(e.name){case f:n=e.body,a.forEach(function(e){e.type===s.EventType.BarcodeScanned&&e.listenerCallback(n)});break;case c:case u:B(e);break;case b:D(e);break;case v:B(e);break;case h:D(e)}var n},s.parseValue=function(e,n=!1){return"string"==typeof e&&""===e.trim()||null==e?null:n?Number(e):e},s.LineItem=function(e,n,t,a=null,r=null,o=null,i=null,c=null,l=null){return Array.isArray(c)&&0===c.length&&(c=null),{name:s.parseValue(e),quantity:s.parseValue(n,!0),unitPrice:s.parseValue(t,!0),vatPercentage:s.parseValue(a,!0)||0,salesTaxPercentage:s.parseValue(r,!0)||0,productId:s.parseValue(o),imei:s.parseValue(i),discounts:c,isExternalProduct:Boolean(l)}};s.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Vipps:"Vipps",Dintero:"Dintero",Invoice:"Invoice"},s.Transaction=function(e,n){return{transactionType:s.parseValue(e),amount:s.parseValue(n,!0)}},s.Discount=function(e,n=null,t=null){if(n=s.parseValue(n,!0),t=s.parseValue(t,!0),null===n&&null===t||null!==n&&null!==t)throw new Error("Either amount or percentage must be set, but not both");return{description:e,amount:n,percentage:t}},s.Basket=function(e,n,t=null,a=null,r=null){return Array.isArray(n)&&0===n.length&&(n=null),Array.isArray(t)&&0===t.length&&(t=null),Array.isArray(a)&&0===a.length&&(a=null),{id:s.parseValue(e),lineItems:n,transactions:t,discounts:a,customerId:s.parseValue(r)}},s.LoginInformation=function(e,n,t,a,r,o){var i={};return i.shopId=e,i.shopName=n,i.registerId=t,i.registerName=a,i.userId=r,i.userName=o,i};return s.EventType={BarcodeScanned:"BarcodeScanned"},s.addEventListener=function(e,n){a.push(new S(e,n))},s.removeEventListener=function(t){a.forEach(function(e,n){e.listenerCallback===t&&a.splice(n,1)})},s.isConnected=function(){return"object"==typeof window.webkit&&"object"==typeof window.webkit.messageHandlers&&"object"==typeof window.webkit.messageHandlers.POS},s.payBasket=function(e,n,t=!1){s.sendBasket(l,e,n,t,!0)},s.addBasket=function(e,n,t=!1,a=!0){s.sendBasket(d,e,n,t,a)},s.sendBasket=function(e,n,t,a,r){var o=j(i);"string"==typeof o?E(t,[!1,o]):A(new V(e,t,{[k]:n,[I]:a,[O]:r}))},s.getLoginInformation=function(e){var n=j(i);"string"==typeof n?E(e,[null,n]):A(new V(t,e))},s.openURL=function(e,n){var t=j(i);"string"==typeof t?E(n,[t]):((t={})[P]=e,A(new V(p,n,t)))},s.printDocumentAtURL=function(e,n){var t=j(i);"string"==typeof t?E(n,[!1,t]):((t={})[P]=e,A(new V(y,n,t)))},s.printDocumentWithData=function(e,t){var n,a,r=j(i);"string"==typeof r?E(t,[!1,r]):(n=function(e){var n={};n[w]=e,A(new V(m,t,n))},"string"!=(r=typeof e)&&"object"!=r&&E(t,[!1,"Data argument of invalid type: "+r]),"string"==r?n(e):((a=new FileReader).onload=function(){var e=a.result,e=e.substr(e.indexOf(",")+1);n(e)},a.readAsDataURL(e)))},s.sendPOSConnectorObjectPathToPOS=function(n,t){var e=j(n);"string"==typeof e?E(t,[e]):((e={})[C]=n,A(new V(g,function(e){"string"==typeof e&&E(t,[e]),i=n,E(t)},e)))},s}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);