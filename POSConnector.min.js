var POSConnector=function(){"use strict";var u={},i="POSConnector",a=0,o={},r=[],t="GetLoginInformation",s="GetLoginInformationCallback",c="PayBasket",l="PayBasketCallback",f="AddBasketCallback",d="AddBasket",p="BarcodeScanned",b="OpenURL",m="OpenURLCallback",y="PrintDocumentAtURL",w="PrintDocumentWithData",g="PrintDocumentCallback",v="SendPOSConnectorObjectPathToPOS",h="SendPOSConnectorObjectPathToPOSCallback",k="basket",P="url",C="data",E="objectPath",I="validate",O="closeWebview";function V(e,n){var t={};return t.type=e,t.listenerCallback=n,t}function S(e,n,t){var r;return"function"==typeof n?(o[r=a]=n,a+=1,new S(e,r,t)):((r={}).name=e,r.callbackId=n,r.body=t,r)}function B(e,n){"function"==typeof e&&e.apply(void 0,n)}function A(e){var n,t;return u.isConnected()?(n=(e=e).split("."),t=window,"string"==typeof(n=n.some(function(e){if(!t.hasOwnProperty(e)||"object"!=typeof t[e])return!0;t=t[e]})?"Invalid component(s) in object path: "+e:"function"!=typeof t.receiveMessage?"Invalid POSConnector object at the end of object path: "+e:void 0)?n:void 0):"No connection is established from the native POS application"}function n(e){var n;if("number"==typeof e)return n=o[e],delete o[e],n}function j(e){window.webkit.messageHandlers.POS.postMessage(e)}function D(e){B(n(e.callbackId),[e.body.result,e.body.error])}function L(e){B(n(e.callbackId),[e.body.error])}u.receiveMessage=function(e){switch(e.name){case p:n=e.body,r.forEach(function(e){e.type===u.EventType.BarcodeScanned&&e.listenerCallback(n)});break;case s:case l:case f:D(e);break;case m:L(e);break;case g:D(e);break;case h:L(e)}var n},u.parseValue=function(e,n=!1){return"string"==typeof e&&""===e.trim()||null==e?null:n?Number(e):e},u.LineItem=function(e,n,t,r=null,a=null,o=null,i=null,s=null,c=!1,l=null){if(e=u.parseValue(e),n=u.parseValue(n,!0),t=u.parseValue(t,!0),e&&n&&t)return Array.isArray(s)&&0!==s.length||(s=null),{name:e,quantity:n,unitPrice:t,vatPercentage:u.parseValue(r,!0),salesTaxPercentage:u.parseValue(a,!0),productId:u.parseValue(o),imei:u.parseValue(i),discounts:s,isExternalProduct:Boolean(c),userId:u.parseValue(l)};throw new Error("Missing required parameters for line item")};u.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Vipps:"Vipps",Dintero:"Dintero",Invoice:"Invoice"},u.Transaction=function(e,n){if(e=u.parseValue(e),n=u.parseValue(n,!0),e&&n)return{transactionType:e,amount:n};throw new Error("Missing required parameters for transaction")},u.Discount=function(e,n=null,t=null){if(e=u.parseValue(e),n=u.parseValue(n,!0),t=u.parseValue(t,!0),!e)throw new Error("Missing required parameters for discount");if(null===n&&null===t||null!==n&&null!==t)throw new Error("Either amount or percentage must be set, but not both");return{description:e,amount:n,percentage:t}},u.Basket=function(e,n,t=null,r=null,a=null){if(!(e=u.parseValue(e)))throw new Error("Missing required parameters for basket");if(Array.isArray(n)&&0!==n.length)return{id:e,lineItems:n,transactions:t=Array.isArray(t)&&0!==t.length?t:null,discounts:r=Array.isArray(r)&&0!==r.length?r:null,customerId:u.parseValue(a)};throw new Error("Basket must have at least 1 line item")},u.LoginInformation=function(e,n,t,r,a,o){var i={};return i.shopId=e,i.shopName=n,i.registerId=t,i.registerName=r,i.userId=a,i.userName=o,i};return u.EventType={BarcodeScanned:"BarcodeScanned"},u.addEventListener=function(e,n){r.push(new V(e,n))},u.removeEventListener=function(t){r.forEach(function(e,n){e.listenerCallback===t&&r.splice(n,1)})},u.isConnected=function(){return"object"==typeof window.webkit&&"object"==typeof window.webkit.messageHandlers&&"object"==typeof window.webkit.messageHandlers.POS},u.payBasket=function(e,n,t=!1){u.sendBasket(c,e,n,t,!0)},u.addBasket=function(e,n,t=!1,r=!0){u.sendBasket(d,e,n,t,r)},u.sendBasket=function(e,n,t,r,a){var o=A(i);"string"==typeof o?B(t,[!1,o]):j(new S(e,t,{[k]:n,[I]:r,[O]:a}))},u.getLoginInformation=function(e){var n=A(i);"string"==typeof n?B(e,[null,n]):j(new S(t,e))},u.openURL=function(e,n){var t=A(i);"string"==typeof t?B(n,[t]):((t={})[P]=e,j(new S(b,n,t)))},u.printDocumentAtURL=function(e,n){var t=A(i);"string"==typeof t?B(n,[!1,t]):((t={})[P]=e,j(new S(y,n,t)))},u.printDocumentWithData=function(e,t){var n,r,a=A(i);"string"==typeof a?B(t,[!1,a]):(n=function(e){var n={};n[C]=e,j(new S(w,t,n))},"string"!=(a=typeof e)&&"object"!=a&&B(t,[!1,"Data argument of invalid type: "+a]),"string"==a?n(e):((r=new FileReader).onload=function(){var e=r.result,e=e.substr(e.indexOf(",")+1);n(e)},r.readAsDataURL(e)))},u.sendPOSConnectorObjectPathToPOS=function(n,t){var e=A(n);"string"==typeof e?B(t,[e]):((e={})[E]=n,j(new S(v,function(e){"string"==typeof e&&B(t,[e]),i=n,B(t)},e)))},u}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);