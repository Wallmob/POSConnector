var POSConnector=function(){"use strict";var e={},n="POSConnector",t=0,r={},a=[],o="GetLoginInformation",i="GetLoginInformationCallback",s="PayBasket",u="PayBasketCallback",c="AddBasketCallback",l="AddBasket",f="BarcodeScanned",d="OpenURL",p="OpenURLCallback",b="PrintDocumentAtURL",m="PrintDocumentWithData",y="PrintDocumentCallback",g="SendPOSConnectorObjectPathToPOS",w="SendPOSConnectorObjectPathToPOSCallback",v="basket",h="url",k="data",P="objectPath",C="validate",E="closeWebview";function I(e,n){var t={};return t.type=e,t.listenerCallback=n,t}function V(e,n,a){if("function"==typeof n){var o=t;return r[o]=n,t+=1,new V(e,o,a)}var i={};return i.name=e,i.callbackId=n,i.body=a,i}function O(e,n){"function"==typeof e&&e.apply(void 0,n)}function S(n){if(!e.isConnected())return"No connection is established from the native POS application";var t=function(e){var n=e.split("."),t=window;return n.some((function(e){if(!t.hasOwnProperty(e)||"object"!=typeof t[e])return!0;t=t[e]}))?"Invalid component(s) in object path: "+e:"function"!=typeof t.receiveMessage?"Invalid POSConnector object at the end of object path: "+e:void 0}(n);return"string"==typeof t?t:void 0}function A(e){if("number"==typeof e){var n=r[e];return delete r[e],n}}function B(e){window.webkit.messageHandlers.POS.postMessage(e)}function j(e){O(A(e.callbackId),[e.body.result,e.body.error])}function D(e){O(A(e.callbackId),[e.body.error])}e.receiveMessage=function(n){switch(n.name){case f:!function(n){var t=n.body;a.forEach((function(n){n.type===e.EventType.BarcodeScanned&&n.listenerCallback(t)}))}(n);break;case i:case u:case c:j(n);break;case p:D(n);break;case y:j(n);break;case w:D(n)}},e.parseValue=function(e,n=!1){return"string"==typeof e&&""===e.trim()||null==e?null:n?Number(e):e},e.LineItem=function(n,t,r,a=null,o=null,i=null,s=null,u=null,c=!1,l=null,f=null,d=null){if(n=e.parseValue(n),t=e.parseValue(t,!0),r=e.parseValue(r,!0),!n||!t||!r)throw new Error("Missing required parameters for line item");if(Array.isArray(u)&&0!==u.length||(u=null),Array.isArray(f)&&f.length>0){if(100!==f.reduce(((e,n)=>e+(n.contributionPercentage||0)),0))throw new Error("Total contribution percentage of contributingUsers must be exactly 100")}else f=null;return{name:n,quantity:t,unitPrice:r,vatPercentage:e.parseValue(a,!0),salesTaxPercentage:e.parseValue(o,!0),productId:e.parseValue(i),imei:e.parseValue(s),discounts:u,isExternalProduct:Boolean(c),userId:e.parseValue(l),contributingUsers:f,productVariantId:e.parseValue(d)}};e.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Vipps:"Vipps",Dintero:"Dintero",Invoice:"Invoice"},e.Transaction=function(n,t){if(n=e.parseValue(n),t=e.parseValue(t,!0),!n||!t)throw new Error("Missing required parameters for transaction");return{transactionType:n,amount:t}},e.Discount=function(n,t=null,r=null){if(n=e.parseValue(n),t=e.parseValue(t,!0),r=e.parseValue(r,!0),!n)throw new Error("Missing required parameters for discount");if(null===t&&null===r||null!==t&&null!==r)throw new Error("Either amount or percentage must be set, but not both");return{description:n,amount:t,percentage:r}},e.Basket=function(n,t,r=null,a=null,o=null){if(!(n=e.parseValue(n)))throw new Error("Missing required parameters for basket");if(!Array.isArray(t)||0===t.length)throw new Error("Basket must have at least 1 line item");return Array.isArray(r)&&0!==r.length||(r=null),Array.isArray(a)&&0!==a.length||(a=null),{id:n,lineItems:t,transactions:r,discounts:a,customerId:e.parseValue(o)}},e.LoginInformation=function(e,n,t,r,a,o){var i={};return i.shopId=e,i.shopName=n,i.registerId=t,i.registerName=r,i.userId=a,i.userName=o,i},e.ContributingUser=function(n,t){if(n=e.parseValue(n),t=e.parseValue(t,!0),!n||!t)throw new Error("Missing required parameters for ContributingUser");if(!Number.isInteger(t)||t<1||t>100)throw new Error("Contribution percentage must be an integer between 1 and 100");return{userId:n,contributionPercentage:t}};return e.EventType={BarcodeScanned:"BarcodeScanned"},e.addEventListener=function(e,n){a.push(new I(e,n))},e.removeEventListener=function(e){a.forEach((function(n,t){n.listenerCallback===e&&a.splice(t,1)}))},e.isConnected=function(){return"object"==typeof window.webkit&&"object"==typeof window.webkit.messageHandlers&&"object"==typeof window.webkit.messageHandlers.POS},e.payBasket=function(n,t,r=!1){e.sendBasket(s,n,t,r,!0)},e.addBasket=function(n,t,r=!1,a=!0){e.sendBasket(l,n,t,r,a)},e.sendBasket=function(e,t,r,a,o){var i=S(n);"string"!=typeof i?B(new V(e,r,{[v]:t,[C]:a,[E]:o})):O(r,[!1,i])},e.getLoginInformation=function(e){var t=S(n);"string"!=typeof t?B(new V(o,e)):O(e,[null,t])},e.openURL=function(e,t){var r=S(n);if("string"!=typeof r){var a={};a[h]=e,B(new V(d,t,a))}else O(t,[r])},e.printDocumentAtURL=function(e,t){var r=S(n);if("string"!=typeof r){var a={};a[h]=e,B(new V(b,t,a))}else O(t,[!1,r])},e.printDocumentWithData=function(e,t){var r=S(n);if("string"!=typeof r){var a=function(e){var n={};n[k]=e,B(new V(m,t,n))},o=typeof e;if("string"!==o&&"object"!==o&&O(t,[!1,"Data argument of invalid type: "+o]),"string"!==o){var i=new FileReader;i.onload=function(){var e=i.result,n=e.substr(e.indexOf(",")+1);a(n)},i.readAsDataURL(e)}else a(e)}else O(t,[!1,r])},e.sendPOSConnectorObjectPathToPOS=function(e,t){var r=S(e);if("string"!=typeof r){var a={};a[P]=e,B(new V(g,(function(r){"string"==typeof r&&O(t,[r]),n=e,O(t)}),a))}else O(t,[r])},e}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);