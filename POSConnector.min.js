var POSConnector=function(){"use strict";function e(e,n){var t={};return t.type=e,t.listenerCallback=n,t}function n(e,t,a){if("function"==typeof t)return void 0===c?c=0:c+=1,l[c]=t,new n(e,c,a);var r={};return r.name=e,r.callbackId=t,r.body=a,r}function t(e){if(void 0!==e&&null!==e){var n=l[e];return delete l[e],n}}function a(e){window.webkit.messageHandlers.POS.postMessage(e)}function r(e){var n=t(e.callbackId);if(n){var a=e.body.result,r=e.body.error;n(a,r)}}function o(e){var n=t(e.callbackId);if(n){var a=e.body.error;n(a)}}function i(e){var n=e.body;u.forEach(function(e){e.type===s.EventType.BarcodeScanned&&e.listenerCallback(n)})}var c,s={},l={},u=[],d={GetLoginInformation:"GetLoginInformation",GetLoginInformationCallback:"GetLoginInformationCallback",PayBasket:"PayBasket",PayBasketCallback:"PayBasketCallback",BarcodeScanned:"BarcodeScanned",OpenURL:"OpenURL",OpenURLCallback:"OpenURLCallback",PrintDocumentAtURL:"PrintDocumentAtURL",PrintDocumentWithData:"PrintDocumentWithData",PrintDocumentCallback:"PrintDocumentCallback"},f={Result:"result",Error:"error",Basket:"basket",URL:"url",Data:"data"},v={NotConnected:"No connection is established from the native POS application"};return s.receiveMessage=function(e){switch(e.name){case d.BarcodeScanned:i(e);break;case d.GetLoginInformationCallback:r(e);break;case d.PayBasketCallback:r(e);break;case d.OpenURLCallback:o(e);break;case d.PrintDocumentCallback:r(e)}},s.LineItem=function(e,n,t,a,r,o,i,c){var s={};return s.name=e,s.quantity=n,s.unitPrice=t,s.vatPercentage=a,s.salesTaxPercentage=r,s.productId=o,s.imei=i,s.discounts=c,s},s.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Point:"Point"},s.Transaction=function(e,n){var t={};return t.transactionType=e,t.amount=n,t},s.Discount=function(e,n,t){var a={};return a.description=e,a.amount=n,a.percentage=t,a},s.Basket=function(e,n,t,a){var r={};return r.id=e,r.lineItems=n,r.transactions=t,r.discounts=a,r},s.LoginInformation=function(e,n,t,a,r,o){var i={};return i.shopId=e,i.shopName=n,i.registerId=t,i.registerName=a,i.userId=r,i.userName=o,i},s.EventType={BarcodeScanned:"BarcodeScanned"},s.addEventListener=function(n,t){u.push(new e(n,t))},s.removeEventListener=function(e){u.forEach(function(n,t){n.listenerCallback===e&&u.splice(t,1)})},s.isConnected=function(){return void 0!==window.webkit&&void 0!==window.webkit.messageHandlers&&void 0!==window.webkit.messageHandlers.POS},s.payBasket=function(e,t){if(!s.isConnected())return void t(!1,v.NotConnected);var r={};r[f.Basket]=e;var o=new n(d.PayBasket,t,r);a(o)},s.getLoginInformation=function(e){if(!s.isConnected())return void e(null,v.NotConnected);var t=new n(d.GetLoginInformation,e);a(t)},s.openURL=function(e,t){var r={};r[f.URL]=e;var o=new n(d.OpenURL,t,r);a(o)},s.printDocumentAtURL=function(e,t){var r={};r[f.URL]=e;var o=new n(d.PrintDocumentAtURL,t,r);a(o)},s.printDocumentWithData=function(e,t){if(void 0===FileReader||void 0===Blob)return void t(!1,"The required Blob and/or FileReader functionality isn't available in this Javascript environment.");var r=function(e){var r=e.substr(e.indexOf(",")+1),o={};o[f.Data]=r;var i=new n(d.PrintDocumentWithData,t,o);a(i)};if(e.type){var o=new FileReader;o.onload=function(){r(o.result)},o.readAsDataURL(e)}else r(e)},s}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);