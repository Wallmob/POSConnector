var POSConnector=function(){"use strict";var r={},i="POSConnector",c=0,s={},o=[],t="GetLoginInformation",a="GetLoginInformationCallback",u="PayBasket",f="PayBasketCallback",d="BarcodeScanned",l="OpenURL",p="OpenURLCallback",b="PrintDocumentAtURL",y="PrintDocumentWithData",m="PrintDocumentCallback",v="SendPOSConnectorObjectPathToPOS",P="SendPOSConnectorObjectPathToPOSCallback",g="basket",k="url",w="data",C="objectPath";function h(e,n){var t={};return t.type=e,t.listenerCallback=n,t}function O(e,n,t){if("function"==typeof n){var o=c;return s[o]=n,c+=1,new O(e,o,t)}var a={};return a.name=e,a.callbackId=n,a.body=t,a}function S(e,n){"function"==typeof e&&e.apply(void 0,n)}function I(e){if(!r.isConnected())return"No connection is established from the native POS application";var n,t,o,a=(t=(n=e).split("."),o=window,t.some(function(e){return!o.hasOwnProperty(e)||"object"!=typeof o[e]||void(o=o[e])})?"Invalid component(s) in object path: "+n:"function"!=typeof o.receiveMessage?"Invalid POSConnector object at the end of object path: "+n:void 0);return"string"==typeof a?a:void 0}function n(e){if("number"==typeof e){var n=s[e];return delete s[e],n}}function j(e){window.webkit.messageHandlers.POS.postMessage(e)}function E(e){S(n(e.callbackId),[e.body.result,e.body.error])}function L(e){S(n(e.callbackId),[e.body.error])}r.receiveMessage=function(e){switch(e.name){case d:n=e.body,o.forEach(function(e){e.type===r.EventType.BarcodeScanned&&e.listenerCallback(n)});break;case a:case f:E(e);break;case p:L(e);break;case m:E(e);break;case P:L(e)}var n},r.LineItem=function(e,n,t,o,a,r,i,c){var s={};return s.name=e,s.quantity=n,s.unitPrice=t,s.vatPercentage=o,s.salesTaxPercentage=a,s.productId=r,s.imei=i,s.discounts=c,s};r.TransactionType={Cash:"Cash",DebitorAccount:"DebitorAccount",Ecommerce:"Ecommerce",External:"External",ExternalCard:"ExternalCard",ExternalGiftCard:"ExternalGiftCard",GiftCardVoucher:"GiftCardVoucher",Installment:"Installment",MobilePay:"MobilePay",Point:"Point"},r.Transaction=function(e,n){var t={};return t.transactionType=e,t.amount=n,t},r.Discount=function(e,n,t){var o={};return o.description=e,o.amount=n,o.percentage=t,o},r.Basket=function(e,n,t,o){var a={};return a.id=e,a.lineItems=n,a.transactions=t,a.discounts=o,a},r.LoginInformation=function(e,n,t,o,a,r){var i={};return i.shopId=e,i.shopName=n,i.registerId=t,i.registerName=o,i.userId=a,i.userName=r,i};return r.EventType={BarcodeScanned:"BarcodeScanned"},r.addEventListener=function(e,n){o.push(new h(e,n))},r.removeEventListener=function(t){o.forEach(function(e,n){e.listenerCallback===t&&o.splice(n,1)})},r.isConnected=function(){return"object"==typeof window.webkit&&"object"==typeof window.webkit.messageHandlers&&"object"==typeof window.webkit.messageHandlers.POS},r.payBasket=function(e,n){var t,o=I(i);"string"!=typeof o?((t={})[g]=e,j(new O(u,n,t))):S(n,[!1,o])},r.addBasket=function(e,n){r.payBasket(e,n)},r.getLoginInformation=function(e){var n=I(i);"string"!=typeof n?j(new O(t,e)):S(e,[null,n])},r.openURL=function(e,n){var t,o=I(i);"string"!=typeof o?((t={})[k]=e,j(new O(l,n,t))):S(n,[o])},r.printDocumentAtURL=function(e,n){var t,o=I(i);"string"!=typeof o?((t={})[k]=e,j(new O(b,n,t))):S(n,[!1,o])},r.printDocumentWithData=function(e,t){var o,n,a,r=I(i);"string"!=typeof r?(o=function(e){var n={};n[w]=e,j(new O(y,t,n))},"string"!=(n=typeof e)&&"object"!=n&&S(t,[!1,"Data argument of invalid type: "+n]),"string"!=n?((a=new FileReader).onload=function(){var e=a.result,n=e.substr(e.indexOf(",")+1);o(n)},a.readAsDataURL(e)):o(e)):S(t,[r])},r.sendPOSConnectorObjectPathToPOS=function(n,t){var e,o=I(n);"string"!=typeof o?((e={})[C]=n,j(new O(v,function(e){"string"==typeof e&&S(t,[e]),i=n,S(t)},e))):S(t,[o])},r}();"object"==typeof module&&"object"==typeof module.exports&&(module.exports=POSConnector);